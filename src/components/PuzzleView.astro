---
import { getPuzzleMeta } from "../lib/puzzles";
import puzzleClientUrl from "../scripts/puzzleClient.ts?url";

type Props = {
  date: string;
  showDate?: boolean;
};

const { date, showDate = true } = Astro.props;
const base = import.meta.env.BASE_URL;

function formatPuzzleDate(dateStr: string): string {
  const [y, m, d] = dateStr.split("-").map(Number);
  const safe = new Date(Date.UTC(y, m - 1, d, 12, 0, 0));
  return new Intl.DateTimeFormat("en-US", {
    month: "short",
    day: "numeric",
    year: "numeric",
    timeZone: "America/New_York",
  }).format(safe);
}

const meta = await getPuzzleMeta(date);
const title = meta?.title?.trim() || `Puzzle for ${formatPuzzleDate(date)}`;
---

<section class="puzzle-view" aria-live="polite">
  <div class="puzzle-header text-center">
    <h1>{title}</h1>
    {showDate ? <p class="puzzle-date">Date: <strong>{date}</strong></p> : null}
  </div>

  <div id={`puzzle-content-${date}`} class="puzzle-content">
    <p>Loading puzzle...</p>
  </div>

  <div id={`qa-${date}`} class="qa"></div>

  <script
    type="module"
    src={puzzleClientUrl}
    data-puzzle-client="1"
    data-date={date}
    data-base={base}
  ></script>
</section>
